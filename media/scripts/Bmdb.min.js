!function(t,e){"object"==typeof exports&&"object"==typeof module?module.exports=e(require("jQuery")):"function"==typeof define&&define.amd?define("Bmdb",["jQuery"],e):"object"==typeof exports?exports.Bmdb=e(require("jQuery")):t.Bmdb=e(t.jQuery)}(window,function(t){return function(t){var e={};function n(r){if(e[r])return e[r].exports;var i=e[r]={i:r,l:!1,exports:{}};return t[r].call(i.exports,i,i.exports,n),i.l=!0,i.exports}return n.m=t,n.c=e,n.d=function(t,e,r){n.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:r})},n.r=function(t){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},n.t=function(t,e){if(1&e&&(t=n(t)),8&e)return t;if(4&e&&"object"==typeof t&&t&&t.__esModule)return t;var r=Object.create(null);if(n.r(r),Object.defineProperty(r,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var i in t)n.d(r,i,function(e){return t[e]}.bind(null,i));return r},n.n=function(t){var e=t&&t.__esModule?function(){return t.default}:function(){return t};return n.d(e,"a",e),e},n.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},n.p="/",n(n.s=24)}([function(e,n){e.exports=t},function(t,e,n){var r=n(20),i=n(21);t.exports=function(t){return function(t){return"string"==typeof t}(t)&&t.length?i(t):r(t)}},function(t,e,n){"use strict";t.exports=n(22)},function(t,e){t.exports=function(t){var e=typeof t;return null!=t&&("object"==e||"function"==e)}},function(t,e,n){var r=n(13),i="object"==typeof self&&self&&self.Object===Object&&self,o=r||i||Function("return this")();t.exports=o},function(t,e){var n;n=function(){return this}();try{n=n||new Function("return this")()}catch(t){"object"==typeof window&&(n=window)}t.exports=n},function(t,e,n){var r=n(4).Symbol;t.exports=r},function(t,e,n){var r=n(3),i=n(12),o=n(14),a="Expected a function",s=Math.max,c=Math.min;t.exports=function(t,e,n){var u,l,f,p,d,h,v=0,b=!1,g=!1,y=!0;if("function"!=typeof t)throw new TypeError(a);function m(e){var n=u,r=l;return u=l=void 0,v=e,p=t.apply(r,n)}function j(t){var n=t-h;return void 0===h||n>=e||n<0||g&&t-v>=f}function w(){var t=i();if(j(t))return x(t);d=setTimeout(w,function(t){var n=e-(t-h);return g?c(n,f-(t-v)):n}(t))}function x(t){return d=void 0,y&&u?m(t):(u=l=void 0,p)}function $(){var t=i(),n=j(t);if(u=arguments,l=this,h=t,n){if(void 0===d)return function(t){return v=t,d=setTimeout(w,e),b?m(t):p}(h);if(g)return clearTimeout(d),d=setTimeout(w,e),m(h)}return void 0===d&&(d=setTimeout(w,e)),p}return e=o(e)||0,r(n)&&(b=!!n.leading,f=(g="maxWait"in n)?s(o(n.maxWait)||0,e):f,y="trailing"in n?!!n.trailing:y),$.cancel=function(){void 0!==d&&clearTimeout(d),v=0,u=h=l=d=void 0},$.flush=function(){return void 0===d?p:x(i())},$}},function(t,e,n){n(2);t.exports=function(t){"use strict";t=t||{};return'<div class="bmdb-category"><ul></ul></div>','<div class="bmdb-category"><ul></ul></div>'}},function(t,e,n){var r=n(2);t.exports=function(t){"use strict";t=t||{};var e="",n=r.$each,i=t.categories,o=(t.$value,t.$index,r.$escape);return n(i,function(t,n){e+=" <li><a ",t.active&&(e+=' class="bmdb-category-active" '),e+=' href="',e+=o(t.url),e+='" title="',e+=o(t.name),e+='"> ',e+=o(t.name),e+=" </a></li> "}),e}},function(t,e,n){var r=n(2);t.exports=function(t){"use strict";t=t||{};var e="",n=r.$each,i=t.skeletons;t.$value,t.$index;return e+='<div class="bmdb-list"><ul class="bmdb-ul"></ul></div><div class="bmdb-loader"><ul class="bmdb-ul"> ',n(i,function(t,n){e+=' <li class="bmdb-li"><div class="bmdb-cover"></div><div class="bmdb-title"></div><div class="bmdb-rank"></div></li> '}),e+=" </ul></div>"}},function(t,e,n){var r=n(2);t.exports=function(t){"use strict";t=t||{};var e="",n=r.$each,i=t.data,o=(t.$value,t.$index,r.$escape);t.starValue;return n(i,function(t,r){e+=' <li class="bmdb-li"><a href="',e+=o(t.doubanUrl),e+='" class="bmdb-link" target="_blank"><div class="bmdb-cover"><img class="bmdb-cover-image" src="',e+=o(t.cover),e+='" alt="',e+=o(t.title),e+='" width="150" height="220"></div><div class="bmdb-info"><div class="bmdb-title">',e+=o(t.title),e+='</div><div class="bmdb-rank"><span class="bmdb-rank-span bmdb-stars"> ',n(t.stars,function(t,n){e+=" ",e+=t?' <span class="bmdb-star bmdb-star-full"></span> ':' <span class="bmdb-star bmdb-star-gray"></span> ',e+=" "}),e+=' </span><span class="bmdb-rank-span">',e+=o(t.rating),e+="</span></div></div></a></li> "}),e}},function(t,e,n){var r=n(4);t.exports=function(){return r.Date.now()}},function(t,e,n){(function(e){var n="object"==typeof e&&e&&e.Object===Object&&e;t.exports=n}).call(this,n(5))},function(t,e,n){var r=n(3),i=n(15),o=NaN,a=/^\s+|\s+$/g,s=/^[-+]0x[0-9a-f]+$/i,c=/^0b[01]+$/i,u=/^0o[0-7]+$/i,l=parseInt;t.exports=function(t){if("number"==typeof t)return t;if(i(t))return o;if(r(t)){var e="function"==typeof t.valueOf?t.valueOf():t;t=r(e)?e+"":e}if("string"!=typeof t)return 0===t?t:+t;t=t.replace(a,"");var n=c.test(t);return n||u.test(t)?l(t.slice(2),n?2:8):s.test(t)?o:+t}},function(t,e,n){var r=n(16),i=n(19),o="[object Symbol]";t.exports=function(t){return"symbol"==typeof t||i(t)&&r(t)==o}},function(t,e,n){var r=n(6),i=n(17),o=n(18),a="[object Null]",s="[object Undefined]",c=r?r.toStringTag:void 0;t.exports=function(t){return null==t?void 0===t?s:a:c&&c in Object(t)?i(t):o(t)}},function(t,e,n){var r=n(6),i=Object.prototype,o=i.hasOwnProperty,a=i.toString,s=r?r.toStringTag:void 0;t.exports=function(t){var e=o.call(t,s),n=t[s];try{t[s]=void 0;var r=!0}catch(t){}var i=a.call(t);return r&&(e?t[s]=n:delete t[s]),i}},function(t,e){var n=Object.prototype.toString;t.exports=function(t){return n.call(t)}},function(t,e){t.exports=function(t){return null!=t&&"object"==typeof t}},function(t,e){var n=Object.prototype.hasOwnProperty,r=Object.prototype.toString;t.exports=function(t){if(null==t)return!0;if("boolean"==typeof t)return!1;if("number"==typeof t)return 0===t;if("string"==typeof t)return 0===t.length;if("function"==typeof t)return 0===t.length;if(Array.isArray(t))return 0===t.length;if(t instanceof Error)return""===t.message;if(t.toString==r)switch(t.toString()){case"[object File]":case"[object Map]":case"[object Set]":return 0===t.size;case"[object Object]":for(var e in t)if(n.call(t,e))return!1;return!0}return!1}},function(t,e,n){"use strict";
/*!
 * is-whitespace <https://github.com/jonschlinkert/is-whitespace>
 *
 * Copyright (c) 2014-2015, Jon Schlinkert.
 * Licensed under the MIT License.
 */var r;t.exports=function(t){return"string"==typeof t&&(r||(r=new RegExp('^[\\s\t\n\v\f\r   ᠎             　\u2028\u2029\ufeff"]+$'))).test(t)}},function(t,e,n){"use strict";(function(e){
/*! art-template@runtime | https://github.com/aui/art-template */
var n="undefined"!=typeof self?self:"undefined"!=typeof window?window:void 0!==e?e:{},r=Object.create(n),i=/["&'<>]/;r.$escape=function(t){return function(t){var e=""+t,n=i.exec(e);if(!n)return t;var r="",o=void 0,a=void 0,s=void 0;for(o=n.index,a=0;o<e.length;o++){switch(e.charCodeAt(o)){case 34:s="&#34;";break;case 38:s="&#38;";break;case 39:s="&#39;";break;case 60:s="&#60;";break;case 62:s="&#62;";break;default:continue}a!==o&&(r+=e.substring(a,o)),a=o+1,r+=s}return a!==o?r+e.substring(a,o):r}(function t(e){"string"!=typeof e&&(e=null==e?"":"function"==typeof e?t(e.call(e)):JSON.stringify(e));return e}(t))},r.$each=function(t,e){if(Array.isArray(t))for(var n=0,r=t.length;n<r;n++)e(t[n],n);else for(var i in t)e(t[i],i)},t.exports=r}).call(this,n(5))},function(t,e,n){},function(t,e,n){"use strict";n.r(e);var r=n(0),i=n.n(r),o=n(7),a=n.n(o);var s={get:function(t){try{var e=window.localStorage.getItem(t);if(e){var n=JSON.parse(e);if(Array.isArray(n))return n}}catch(t){}return[]},set:function(t,e){try{window.localStorage.setItem(t,JSON.stringify(e))}catch(t){}}},c={API_BASE_URL:"https://bm.weajs.com/api/",DB_BASE_URL:"https://m.douban.com/movie/subject/"},u=n(1),l=n.n(u);var f={param2object:function(t){var e={};if(t=t.replace(/^\?/,""),l()(t))return e;var n=t.split("&");return n.length>0&&n.forEach(function(t){var n=t.split("=");if(n.length>0){var r=n[1];e[n[0]]=l()(r)?"":decodeURIComponent(r)}}),e},object2param:function(t){var e=[],n=Object.keys(t);return n.length>0&&n.forEach(function(n){e.push(n+"="+t[n])}),e.join("&")}};function p(){return(p=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var d=n(8),h=n.n(d),v=n(9),b=n.n(v),g=function(){function t(t){this.app=t,this.app.showCategories&&(this.apiUrl=this.app.apiUrl+"/categories",this.cacheKey=(this.app.namespace+"_categories").toUpperCase(),this.location=this.parseLocation(),this.app.category=this.location.query[this.cacheKey],this.$container=i()(h()()).prependTo(this.app.$container),this.$list=this.$container.find("ul"),this.getData())}var e=t.prototype;return e.parseLocation=function(){var t=window.location;return{href:t.href,origin:t.origin+t.pathname,query:this.app.urlParam.param2object(t.search)}},e.getData=function(){var t=this,e=this.cache;if(e){var n=this.app.store.get(this.cacheKey);this.render(n)}i.a.ajax({url:this.apiUrl,data:{secret:this.app.secret},dataType:"json"}).then(function(n){e&&t.app.store.set(t.cacheKey,n),t.render(n)}).catch(function(t){console.error("[BMDB]",t)})},e.render=function(t){var e=this,n={name:"全部",url:this.getCategoryUrl(""),active:l()(this.app.category)};this.$list.append(b()({categories:[n].concat((l()(this.app.categoryFilters)?t:t.filter(function(t){return e.app.categoryFilters.includes(t)})).map(function(t){var n=e.getCategoryUrl(t);return{name:t,active:t===e.app.category,url:n}}))}))},e.getCategoryUrl=function(t){var e,n=this.location,r=n.origin,i=n.query;return r+"?"+this.app.urlParam.object2param(p({},i,((e={})[this.cacheKey]=encodeURIComponent(t),e)))},t}(),y=function(t){new g(t)},m=n(10),j=n.n(m),w=n(11),x=n.n(w),$=function(){function t(t){var e=t.type,n=t.selector,r=t.secret,o=t.limit,a=t.showCategories,u=t.categoryFilters,l=t.skeletonNum,p=t.noMoreText,d=t.cache;this.apiUrl=""+c.API_BASE_URL+(e||"movies"),this.noMoreText=p||"",this.skeletonNum=l||5,this.page=1,this.secret=r,this.limit=o||30,this.isLoading=!1,this.category=void 0,this.categoryFilters=u||[],this.showCategories="movies"===e&&!!a,this.cache=void 0===d||!!d,this.namespace=("bmdb_"+e).toUpperCase(),this.cacheKey=null,this.store=s,this.urlParam=f,this.$container=i()(n),this.$window=i()(window),this.setViews(),this.addPlugin(y),this.getData(),this.bindScrollEvent()}var e=t.prototype;return e.setViews=function(){this.$container.append(j()({skeletons:Array.from({length:this.skeletonNum})})),this.$list=this.$container.find(".bmdb-list .bmdb-ul"),this.$loader=this.$container.find(".bmdb-loader")},e.bindScrollEvent=function(){var t=this;this.scrollFn=a()(function(){t.onScroll()},16),this.$window.on("scroll",this.scrollFn)},e.onScroll=function(){this.$window.scrollTop()+this.$window.height()+100>this.$loader.offset().top&&this.getData()},e.getData=function(){var t=this;if(!this.isLoading){this.isLoading=!0;var e=this.cache&&1===this.page;if(e){this.cacheKey=this.category?this.namespace+":"+this.category:this.namespace;var n=this.store.get(this.cacheKey);this.render(n)}var r={page:this.page,limit:this.limit,secret:this.secret};this.category&&(r.category=this.category),i.a.ajax({url:this.apiUrl,data:r,dataType:"json"}).then(function(n){n.length<t.limit&&(t.setNoMoreDataView(),t.offScrollEvent()),e&&(t.$list.html(""),t.store.set(t.cacheKey,n)),t.render(n),t.page+=1,t.isLoading=!1}).catch(function(e){t.isLoading=!1,console.error("[BMDB]",e)})}},e.render=function(t){t.length>0&&(t=t.map(function(t){var e=Math.round(t.rating/2);return t.doubanUrl=""+c.DB_BASE_URL+t.doubanId,t.stars=Array.from({length:5}).map(function(t,n){return n+1<=e}),t.rating=t.rating.includes(".")?t.rating:t.rating+".0",t}),this.$list.append(x()({data:t})))},e.setNoMoreDataView=function(){this.$loader.text(this.noMoreText)},e.offScrollEvent=function(){this.$window.off("scroll",this.scrollFn)},e.addPlugin=function(t){t(this)},t}();n(23),e.default=$}]).default});
//# sourceMappingURL=Bmdb.min.js.map